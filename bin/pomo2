#!/bin/bash

# Pomodoro durations
POMODORO_DURATION=25  # Pomodoro work duration in minutes
SHORT_BREAK=5         # Short break duration in minutes
LONG_BREAK=15         # Long break duration in minutes
POMODOROS_BEFORE_LONG_BREAK=4  # Number of Pomodoros before a long break

TOMATO="üçÖ"
ICON_PATH="/path/to/icon.png"  # Update with the path to your icon if needed

# Initialize variables
TIME_REMAINING=$((POMODORO_DURATION * 60))
PAUSED=0
RUNNING=0
pomodoro_count=0

# Function to display the timer
display_timer() {
    clear
    local mins=$((TIME_REMAINING / 60))
    local secs=$((TIME_REMAINING % 60))
    echo -e "\n$message\n\nTime remaining: $(printf "%02d:%02d" $mins $secs)"
    echo -e "\nPress 'p' to pause, 'r' to resume, 'q' to quit."
}

# Function to countdown
countdown() {
    local duration=$1
    message=$2
    TIME_REMAINING=$((duration * 60))
    RUNNING=1

    while [ $TIME_REMAINING -gt 0 ]; do
        if [ $PAUSED -eq 1 ]; then
            read -rsn1 key
            if [ "$key" == "r" ]; then
                PAUSED=0
            elif [[ "$key" == $'\e' || "$key" == "q" ]]; then
                echo "\nExiting..."
                exit 0
            fi
            continue
        fi

        display_timer
        read -rsn1 -t 1 key
        if [ "$key" == "p" ]; then
            PAUSED=1
        elif [[ "$key" == $'\e' || "$key" == "q" ]]; then
            echo "\nExiting..."
            exit 0
        fi
        TIME_REMAINING=$((TIME_REMAINING - 1))
    done
    RUNNING=0
}

# Function to send notifications
send_notification() {
    local title=$1
    local message=$2

    if [[ "$OSTYPE" == "darwin"* ]]; then
        # macOS notification
        osascript -e "display notification \"$message\" with title \"$title\" subtitle \"\" sound name \"default\""
    elif [[ "$OSTYPE" == "linux-gnu"* ]]; then
        # Linux notification
        notify-send -i "$ICON_PATH" "$title" "$message"
    fi
}

# Main loop with a starting menu
while true; do
    clear
    echo -e "Pomodoro Timer $TOMATO\n"
    echo "1) Start Pomodoro"
    echo "2) Short Break"
    echo "3) Long Break"
    echo "4) Exit"
    echo -n "Choose an option: "
    read -rsn1 choice

    case $choice in
        1)
            send_notification "Pomodoro Timer" "Work session started"
            countdown $POMODORO_DURATION "Work session"
            ((pomodoro_count++))
            send_notification "Pomodoro Timer" "Pomodoro complete! Total: $TOMATO $pomodoro_count"
            echo "Pomodoro complete! Total: $TOMATO $pomodoro_count"

            if ((pomodoro_count % POMODOROS_BEFORE_LONG_BREAK == 0)); then
                send_notification "Pomodoro Timer" "Long break started"
                countdown $LONG_BREAK "Long break"
            else
                send_notification "Pomodoro Timer" "Short break started"
                countdown $SHORT_BREAK "Short break"
            fi
            ;;
        2)
            send_notification "Pomodoro Timer" "Short break started"
            countdown $SHORT_BREAK "Short break"
            ;;
        3)
            send_notification "Pomodoro Timer" "Long break started"
            countdown $LONG_BREAK "Long break"
            ;;
        4)
            clear
            echo "Exiting..."
            exit 0
            ;;
    esac
done
